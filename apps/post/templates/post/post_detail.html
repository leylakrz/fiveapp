{% extends 'base.html' %}
{% load static %}
{% load  messenger_tags %}
{% load post_tags %}

{% block title %}{{ task.title }}{% endblock %}

{% block style %}
    <link rel="stylesheet" type="text/css" href="{% static 'post/post_detail.css' %}">
{% endblock %}


{% block body %}
    <h2>{{ post.title }}</h2>
    <p>By <a href="{% url 'profile' post.publisher.id %}">{{ post.publisher.email }}</a><br>
        Published {{ post.age|custom_time_format }} Ago</p>

    {% if post.photo %}
        <img src="{{ post.photo.url }}" style="max-height: 400px; max-width: 400px; border: solid 1px black;">
    {% endif %}

    <p>{{ post.content }}</p><br><br>

    <a href="{% url 'likes' post.slug %}">likes: {% like_count post.liked %}</a>

    {% if post.publisher.id != user.id and user not in post.liked.all %}
        <form method="post">
            {% csrf_token %}
            <input type="submit" value="Like" name="like">
        </form>
    {% endif %}
    <br><br>
    {% if post.publisher == user %}
        <form method="post">
            {% csrf_token %}
            <a href="{% url 'post_edit' post.slug %}">
                <button type="button">edit</button>
            </a>
            <a href="{% url 'post_delete' post.slug %}">
                <button type="button">delete</button>
            </a>
        </form>
    {% endif %}
    <br><br>

    <hr>

    <h3>Add a Comment:</h3>
    <form action="" method="post">
        {% csrf_token %}
        <table>
            {#            <tr>{{ comment_form.as_table }}</tr>#}
            <tr>
                <td><a>Title:</a></td>
                <td><input type="text" name="title" style="width: 250px;"></td>
            </tr>
            <tr>
                <td><b>content:</b></td>
                <td>
                    <textarea name="content" cols="40" rows="10" required=""
                              style="height: 150px; width: 250px;"></textarea>
                </td>
            </tr>
            <tr>
                <td></td>
                <td>
                    <input type="submit" VALUE="Add" name="comment">
                    <a href="{% url 'post' post.slug %}">
                        <button type="button">Refresh</button>
                    </a>
                </td>
            </tr>
        </table>
    </form>


    <br><h3>Comments:</h3>
    {% if comments %}
        {% for comment in comments %}
            <div class="comment">
                <b>{{ comment.title }}</b>
                <p>by <a href="{% url 'profile' comment.publisher.id %}">{{ comment.publisher.email }}</a></p>
                <p>{{ comment.content }}</p>
                <p>published: {{ comment.age|custom_time_format }} Ago</p>
                {% if user == comment.publisher %}
                    <form method="post" action="{% url 'post' post.slug %}?comment={{ comment.id }}">
                        {% csrf_token %}
                        <input type="submit" name="delete_comment" value="Delete">
                    </form>
                    <br>
                    <br>
                    </div>
                {% endif %}

        {% endfor %}
    {% else %}
        no comments.<br><br><br>
    {% endif %}

{% endblock %}